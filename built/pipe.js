//     pipe
//     (c) simonfan
//     pipe is licensed under the MIT terms.

define("__pipe/mapping",["require","exports","module","lodash"],function(i,e){var n=i("lodash");e.to=function(i){return i=n.isArray(i)?i:[i],this.destinations=i,this},e.rmDestination=function(){},e.from=function(i){return this.cache={},this.source=i,this}}),define("__pipe/stream-control",["require","exports","module","lodash","q"],function(i,e){function n(i,e,n){var t=i[n];return o.cacheTmp[n]=t,e(t)}function t(i,e,n){var t=i[n];return o.cacheTmp[n]=t,e(n,t)}function r(i){var e=this.source,r=i.matcher,o=i.fn,u=[];if(s.isString(r)&&this.changed(r))u.push(n(e,o,r));else if(s.isRegExp(r))for(var c in e)r.test(c)&&this.changed(c)&&u.push(t(e,o,c));return 1===u.length?u[0]:a.all(u)}var s=i("lodash"),a=i("q"),o={cacheTmp:{}};e.push=function(i){var e=a.defer();i=i?s.pick(this.lines,i):this.lines;var n=s.map(i,r,this);return s.assign(this.cache,o.cacheTmp),o.cacheTmp={},a.all(n).done(function(){e.resolve()}),e.promise},e.inject=function(i){return s.assign(this.source,i),this.push()}}),define("__pipe/auxiliary",["require","exports","module"],function(i,e){var n=/\*/g;e.wildcard=function(i){var e;return i.match(n)?(e=i.replace(n,".*"),e=new RegExp(e)):e=i,e}}),define("__pipe/line/fn",["require","exports","module","lodash","q"],function(i,e,n){function t(i){var e=Array.prototype.slice.call(arguments,1),n=u.map(i,function(i){return i.apply(this,e)});return c.all(n)}function r(i,e){var n=u.map(i,function(i){return o.call(this,i,e)},this);return u.partial(t,n)}function s(i){var e=i.match(h);if(!e)throw new Error("Invalid line definition for jquery-pipe.");return{method:e[1],args:e[2]?e[2].split(p):[]}}function a(i){var e=s(i);return u.bind(function(){var i=e.args.concat(u.toArray(arguments)),n=u.map(this.destinations,function(n){return n[e.method].apply(n,i)});return c.all(n)},this)}function o(i,e){return u.isString(i)?a.call(this,i,e):u.isArray(i)?r.call(this,i,e):u.isFunction(i)?i:void 0}var u=i("lodash"),c=i("q"),h=/^\s*([^:]*)(?::(.*))?$/,p=/\s*,\s*/g;n.exports=o}),define("__pipe/line/index",["require","exports","module","../auxiliary","./fn"],function(i,e){var n=i("../auxiliary"),t=i("./fn");e.line=function(){var i,e;return 1===arguments.length?(i="*",e=arguments[0]):(i=arguments[0],e=arguments[1]),this.lines[i]={fn:t.call(this,e,i),matcher:n.wildcard(i)},this},e.pipeline=e.line,e.rmLine=function(i){return delete this.lines[i],this}}),define("pipe",["require","exports","module","subject","lodash","./__pipe/mapping","./__pipe/stream-control","./__pipe/line/index"],function(i,e,n){var t=i("subject"),r=i("lodash"),s=n.exports=t({initialize:function(i,e){e=e||{},this.source={},e.source&&this.from(source),e.destination&&this.to(e.destination),this.cache=e.cache===!1?!1:{},this.lines={},r.each(i,function(i,e){this.line(e,i)},this)},changed:function(i){return this.source[i]!==this.cache[i]}});s.assignProto(i("./__pipe/mapping")).assignProto(i("./__pipe/stream-control")).assignProto(i("./__pipe/line/index"))});