//     pipe
//     (c) simonfan
//     pipe is licensed under the MIT terms.

define("__pipe/mapping",["require","exports","module","lodash"],function(i,e){var n=i("lodash");e.to=function(i){return i=n.isArray(i)?i:[i],this.destinations=i,this},e.rmDestination=function(){},e.from=function(i){return this.cache={},this.source=i,this}}),define("__pipe/stream-control",["require","exports","module","lodash","q"],function(i,e){function n(i,e,n){var t=i[n];return a.cacheTmp[n]=t,e(t,n)}function t(i){var e=this.source,t=i.matcher,a=i.fn,o=[];if(r.isString(t)&&this.changed(t))o.push(n(e,a,t));else if(r.isRegExp(t))for(var u in e)t.test(u)&&this.changed(u)&&o.push(n(e,a,u));return 1===o.length?o[0]:s.all(o)}var r=i("lodash"),s=i("q"),a={cacheTmp:{}};e.push=function(i){var e=s.defer();i=i?r.pick(this.lines,i):this.lines;var n=r.map(i,t,this);return r.assign(this.cache,a.cacheTmp),a.cacheTmp={},s.all(n).done(function(){e.resolve()}),e.promise},e.inject=function(i){return r.assign(this.source,i),this.push()}}),define("__pipe/auxiliary",["require","exports","module"],function(i,e){var n=/\*/g;e.wildcard=function(i){var e;return i.match(n)?(e=i.replace(n,".*"),e=new RegExp(e)):e=i,e}}),define("__pipe/line/fn",["require","exports","module","lodash","q"],function(i,e,n){function t(i){return s.bind(function(){var e=s.toArray(arguments),n=s.map(this.destinations,function(n){return n[i].apply(n,e)});return a.all(n)},this)}function r(i,e){return s.isString(i)?t.call(this,i,e):s.isArray(i)?arrayLine.call(this,i,e):s.isFunction(i)?i:void 0}var s=i("lodash"),a=i("q");n.exports=r}),define("__pipe/line/index",["require","exports","module","../auxiliary","./fn"],function(i,e){var n=i("../auxiliary"),t=i("./fn");e.line=function(){var i,e;return 1===arguments.length?(i="*",e=arguments[0]):(i=arguments[0],e=arguments[1]),this.lines[i]={fn:t.call(this,e,i),matcher:n.wildcard(i)},this},e.pipeline=e.line,e.rmLine=function(i){return delete this.lines[i],this}}),define("pipe",["require","exports","module","subject","lodash","./__pipe/mapping","./__pipe/stream-control","./__pipe/line/index"],function(i,e,n){var t=i("subject"),r=i("lodash"),s=n.exports=t({initialize:function(i,e){e=e||{},this.source={},e.source&&this.from(source),e.destination&&this.to(e.destination),this.cache=e.cache===!1?!1:{},this.lines={},r.each(i,function(i,e){this.line(e,i)},this)},changed:function(i){return this.source[i]!==this.cache[i]}});s.assignProto(i("./__pipe/mapping")).assignProto(i("./__pipe/stream-control")).assignProto(i("./__pipe/line/index"))});