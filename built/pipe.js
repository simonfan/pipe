//     pipe
//     (c) simonfan
//     pipe is licensed under the MIT terms.

define("__pipe/pump",["require","exports","module","lodash"],function(t,e){var i=t("lodash");e.pump=function(t,e){var s=this.maps.to,c=this.src,h=this.dest;t=t?i.pick(s,t):s,i.each(t,function(t,s){var r=this.srcGet(c,s);i.each(t,function(t){(!this.cacheCheck("dest",t,r)||e&&e.force)&&(this.destSet(h,t,r),this.cacheSet("dest",t,r))},this)},this)}}),define("__pipe/drain",["require","exports","module","lodash"],function(t,e){var i=t("lodash");e.drain=function(){var t,e,s=arguments[0],c=arguments[1],h=this.maps.from;i.isArray(s)?(t=i.pick(h,s),e=c):i.isString(s)?(t={},t[s]=h[s],e=c):(t=h,e=s),e=e||{};{var r=e.force;this.src,this.dest}return i.each(t,function(t,e){var i=this.destGet(this.dest,t[0]);(r||!this.cacheCheck("src",e,i))&&(this.srcSet(this.src,e,i),this.cacheSet("src",e,i))},this),this}}),define("__pipe/inject",["require","exports","module","lodash"],function(t,e){var i=t("lodash");e.inject=function(t,e){if(!this.src)throw new Error("No src for pipe");i.each(t,function(t,i){(!this.isCached(i,t)||e&&e.force)&&this.srcSet(this.src,i,t)},this),this.pump(null,{force:!0})}}),define("__pipe/map",["require","exports","module","lodash"],function(t,e){var i=t("lodash");e.mapSingle=function(t,e,s){e=i.isArray(e)?e:[e],s&&"both"!==s?this.maps[s][t]=e:(this.maps.to[t]=e,this.maps.from[t]=e)},e.map=function(){if(i.isString(arguments[0]))this.mapSingle.apply(this,arguments);else if(i.isObject(arguments[0])){var t=arguments[1];i.each(arguments[0],function(e,s){var c;i.isString(e)?c=e:(c=e.dest,t=e.direction||t),this.mapSingle(s,c,t)},this)}return this},e.unmap=function(t){return i.each(this.maps,function(e){delete e[t]}),this}}),define("__pipe/cache",["require","exports","module"],function(t,e){e.isCached=function(t,e){return this.cache?this.cache[t]!==e?(this.cache[t]=e,!1):!0:!1},e.cacheGet=function(t,e){return this.cache[t][e]},e.cacheSet=function(t,e,i){return this.cache[t][e]=i,this},e.cacheCheck=function(t,e,i){return this.cache===!1?!1:this.cacheGet(t,e)===i},e.cacheClear=function(t,e){if(0===arguments.length)this.cache={src:{},dest:{}};else if(1===arguments.length)this.cache[t]==={};else{e=_.isArray(e)?e:[e];var i=this.cache[t];_.each(e,function(t){delete i[t]},this)}return this}}),define("pipe",["require","exports","module","subject","lodash","./__pipe/pump","./__pipe/drain","./__pipe/inject","./__pipe/map","./__pipe/cache"],function(t,e,i){var s=t("subject"),c=(t("lodash"),i.exports=s({initialize:function(t,e,i,s){s=s||{},this.srcGet=this.srcGet||this.get,this.srcSet=this.srcSet||this.set,this.destGet=this.destGet||this.get,this.destSet=this.destSet||this.set,s.cache!==!1&&this.cacheClear(),this.maps={from:{},to:{}},t&&this.from(t),e&&this.to(e),i&&this.map(i,s.direction)},get:function(t,e){return t[e]},set:function(t,e,i){return t[e]=i,t},from:function(t){return this.cacheClear(),this.src=t,this},to:function(t){return this.cacheClear(),this.dest=t,this}}));c.assignProto(t("./__pipe/pump")).assignProto(t("./__pipe/drain")).assignProto(t("./__pipe/inject")).assignProto(t("./__pipe/map")).assignProto(t("./__pipe/cache"))});