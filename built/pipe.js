//     pipe
//     (c) simonfan
//     pipe is licensed under the MIT terms.

define("__pipe/mapping",["require","exports","module","lodash"],function(t,i){var e=t("lodash");i.to=function(t){return this.clearCache(),t=e.isArray(t)?t:[t],this.destinations=t,this},i.addDestination=function(t){return this.clearCache(),t=e.isArray(t)?t:[t],this.destinations||(this.destinations=[]),this.destinations=this.destinations.concat(t),this},i.removeDestination=function(t,i){return this.clearCache(),e.remove(this.destinations,t,i),this},i.from=function(t){return this.clearCache(),this.source=t,this}}),define("__pipe/streams",["require","exports","module","lodash","q"],function(t,i){function e(t,i){var e=h.defer();i=i?r.pick(this.lines,i):this.lines;var s=r.map(i,function(i,e){t.call(this,e,i)},this);return h.all(s).done(function(){e.resolve()}),e.promise}function s(t,i){var e=this._srcGet(this.source,t);if(e!==this.cache.src[t]){var s=r.map(i,function(t){var i=r.map(this.destinations,function(i){return this._destSet(i,t,e)},this);h.all(i)},this);return this.cache.src[t]=e,h.all(s)}}function n(t,i){var e=this._destGet(this.destinations[0],i[0]);return e!==this.cache.dest[i]?this._srcSet(this.source,t,e):void 0}var r=t("lodash"),h=t("q");i.pump=r.partial(e,s),i.drain=r.partial(e,n),i.inject=function(t){if(!this.source)throw new Error("No source for pipe");var i=r.map(t,function(t,i){return this._srcSet(this.source,i,t)},this);return h.all(i).then(r.bind(function(){return this.pump()},this),function(t){throw t})}}),define("__pipe/line",["require","exports","module","lodash"],function(t,i){var e=t("lodash");i.line=function(){var t,i;return e.isString(arguments[0])?(t=arguments[0],i=arguments[1]||t,i=e.isArray(i)?i:[i],this.lines[t]=i):e.isObject(arguments[0])&&e.each(arguments[0],function(t,i){this.line(i,t)},this),this},i.removeLine=function(t){return delete this.lines[t],this}}),define("pipe",["require","exports","module","subject","lodash","./__pipe/mapping","./__pipe/streams","./__pipe/line"],function(t,i,e){var s=t("subject"),n=t("lodash"),r=["srcGet","srcSet","destGet","destSet"],h=e.exports=s({initialize:function(t,i){i=i||{},n.each(r,function(t){this[t]=i[t]||this[t]},this),this._srcGet=this.srcGet||this.get,this._srcSet=this.srcSet||this.set,this._destGet=this.destGet||this.get,this._destSet=this.destSet||this.set,this.cache=i.cache===!1?!1:{src:{},dest:{}},i.source&&this.from(source),i.destination&&this.to(i.destination),this.lines={},this.line(t)},get:function(t,i){return t[i]},set:function(t,i,e){return t[i]=e,t},clearCache:function(){return this.cache={src:{},dest:{}},this}});h.assignProto(t("./__pipe/mapping")).assignProto(t("./__pipe/streams")).assignProto(t("./__pipe/line"))});