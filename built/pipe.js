//     pipe
//     (c) simonfan
//     pipe is licensed under the MIT terms.

define("__pipe/mapping",["require","exports","module","lodash"],function(t,e){t("lodash");e.to=function(t){return this.clearCache(),this.destination=t,this},e.from=function(t){return this.clearCache(),this.source=t,this}}),define("__pipe/streams/pump",["require","exports","module","lodash","q"],function(t,e,i){function s(t,e,i){var s=n.map(i,function(i){return this._destSet(e,i,t)},this);return r.all(s)}var n=t("lodash"),r=t("q");i.exports=function(t,e){var i=this.destination;return r(this._srcGet(this.source,t)).then(n.bind(function(n){return n!==this.cache.src[t]?(this.cache.src[t]=n,s.call(this,n,i,e)):void 0},this)).fail(function(t){throw t})}}),define("__pipe/streams/drain",["require","exports","module","lodash","q"],function(t,e,i){var s=t("lodash"),n=t("q");i.exports=function(t,e){return n(this._destGet(this.destination,e[0])).then(s.bind(function(i){return i!==this.cache.dest[e]?this._srcSet(this.source,t,i):void 0},this)).fail(function(t){throw t})}}),define("__pipe/streams/index",["require","exports","module","lodash","q","./pump","./drain"],function(t,e){function i(t,e){var i=n.defer();e=e?s.pick(this.lines,e):this.lines;var r=s.map(e,function(e,i){return t.call(this,i,e)},this);return n.all(r).done(function(){i.resolve()}),i.promise}var s=t("lodash"),n=t("q");e.pump=s.partial(i,t("./pump")),e.drain=s.partial(i,t("./drain")),e.inject=function(t){if(!this.source)throw new Error("No source for pipe");var e=s.map(t,function(t,e){return this._srcSet(this.source,e,t)},this);return n.all(e).then(s.bind(function(){this.pump()},this),function(t){throw t})}}),define("__pipe/line",["require","exports","module","lodash"],function(t,e){var i=t("lodash");e.line=function(){var t,e;return i.isString(arguments[0])?(t=arguments[0],e=arguments[1]||t,e=i.isArray(e)?e:[e],this.lines[t]=e):i.isObject(arguments[0])&&i.each(arguments[0],function(t,e){this.line(e,t)},this),this},e.removeLine=function(t){return delete this.lines[t],this}}),define("pipe",["require","exports","module","subject","lodash","./__pipe/mapping","./__pipe/streams/index","./__pipe/line"],function(t,e,i){var s=t("subject"),n=t("lodash"),r=["srcGet","srcSet","destGet","destSet"],o=i.exports=s({initialize:function(t,e){e=e||{},n.each(r,function(t){this[t]=e[t]||this[t]},this),this._srcGet=this.srcGet||this.get,this._srcSet=this.srcSet||this.set,this._destGet=this.destGet||this.get,this._destSet=this.destSet||this.set,this.cache=e.cache===!1?!1:{src:{},dest:{}},e.source&&this.from(e.source),e.destination&&this.to(e.destination),this.lines={},this.line(t)},get:function(t,e){return t[e]},set:function(t,e,i){return t[e]=i,t},clearCache:function(){return this.cache={src:{},dest:{}},this}});o.assignProto(t("./__pipe/mapping")).assignProto(t("./__pipe/streams/index")).assignProto(t("./__pipe/line"))});