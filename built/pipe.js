//     pipe
//     (c) simonfan
//     pipe is licensed under the MIT terms.

define("__pipe/pump",["require","exports","module","lodash"],function(t,i){var e=t("lodash");i.pump=function(t,i){var s=this.maps.to,r=this.src,h=this.dest;t=t?e.pick(s,t):s;var n=i&&i.force;e.each(t,function(t,i){var s=this.srcGet(r,i);e.each(t,function(t){(n||!this.cacheCheck(i,s))&&this.destSet(h,t,s)},this)},this)}}),define("__pipe/drain",["require","exports","module","lodash"],function(t,i){var e=t("lodash");i.drain=function(){var t,i,s=arguments[0],r=arguments[1],h=this.maps.from;e.isArray(s)?(t=e.pick(h,s),i=r):e.isString(s)?(t={},t[s]=h[s],i=r):(t=h,i=s),i=i||{};{var n=i.force;this.src,this.dest}return e.each(t,function(t,i){var e=this.destGet(this.dest,t[0]);(n||!this.cacheCheck(i,e))&&this.srcSet(this.src,i,e)},this),this}}),define("__pipe/inject",["require","exports","module","lodash"],function(t,i){var e=t("lodash");i.inject=function(t,i){if(!this.src)throw new Error("No src for pipe");e.each(t,function(t,e){(!this.cacheCheck(e,t)||i&&i.force)&&this.srcSet(this.src,e,t)},this),this.pump(null,{force:!0})}}),define("__pipe/map",["require","exports","module","lodash"],function(t,i){var e=t("lodash");i.mapSingle=function(t,i,s){i=e.isArray(i)?i:[i],s&&"both"!==s?this.maps[s][t]=i:(this.maps.to[t]=i,this.maps.from[t]=i)},i.map=function(){if(e.isString(arguments[0]))this.mapSingle.apply(this,arguments);else if(e.isObject(arguments[0])){var t=arguments[1];e.each(arguments[0],function(i,s){var r;e.isString(i)?r=i:(r=i.dest,t=i.direction||t),this.mapSingle(s,r,t)},this)}return this},i.unmap=function(t){return e.each(this.maps,function(i){delete i[t]}),this}}),define("__pipe/cache",["require","exports","module"],function(t,i){i.cacheClear=function(){return this.cache={},this},i.cacheCheck=function(t,i){return this.cache?this.cache[t]!==i?(this.cache[t]=i,!1):!0:!1}}),define("pipe",["require","exports","module","subject","lodash","./__pipe/pump","./__pipe/drain","./__pipe/inject","./__pipe/map","./__pipe/cache"],function(t,i,e){var s=t("subject"),r=(t("lodash"),e.exports=s({initialize:function(t,i,e,s){s=s||{},this.srcGet=this.srcGet||this.get,this.srcSet=this.srcSet||this.set,this.destGet=this.destGet||this.get,this.destSet=this.destSet||this.set,s.cache!==!1&&this.cacheClear(),this.maps={from:{},to:{}},t&&this.from(t),i&&this.to(i),e&&this.map(e,s.direction)},get:function(t,i){return t[i]},set:function(t,i,e){return t[i]=e,t},from:function(t){return this.cacheClear(),this.src=t,this},to:function(t){return this.cacheClear(),this.dest=t,this}}));r.assignProto(t("./__pipe/pump")).assignProto(t("./__pipe/drain")).assignProto(t("./__pipe/inject")).assignProto(t("./__pipe/map")).assignProto(t("./__pipe/cache"))});